---
title: 日付型／日時型データ項目を更新する
layout: default
date: 2025-10-14
nav_order: 1
lead: 日付・日時データを活用するための仕様と代表的な EL 式の使い方を整理しました。
---

## **データ更新工程の概要**

「データ更新」とは、業務データを指定の値または式の評価結果によって自動的に更新する工程です。

**仕様および注意点:**
- ひとつの工程で複数のデータ項目を同時に更新できます
- 設定対象のデータ項目には、日付型、日時型が含まれます
- 更新値は固定値でもよく、EL式（SpEL）による動的な評価結果を使うこともできます
- 工程の設定では、対象データの選択、値または式の編集、参照の挿入（プロセス開始日時やユーザ名など）が可能です
- 「データ更新」工程において、書式を何も設定しない場合は空値（null）が設定され、元のデータは消去されます
- 複数の項目に値を設定する場合、それらは同時に評価され、順序は保証されません

次に、「データ更新」に使える日付型および日時型の設定書式と変換操作の方法について説明します。

---

## **日時型／日付型データに関する文法知識**

業務プロセスで「日付型」および「日時型」のデータを操作する際には、それぞれの特性と目的に応じて適切なメソッドを使い分ける必要があります。以下では、すべてのメソッドとその機能を分類して紹介します。

---

### 1. データ型の特性

#### a. 日付型

**仕様および注意点:**
- 「年月日（YMD）」のみを扱うシンプルなデータ型で、時分情報は含まれません。
- ミリ秒単位の精度を持ち、ワークフロー基盤のタイムゾーン（例：JST +09:00）に従って解釈されます。
- このドキュメントに、日付型データ項目は、`#q_date` で表示します、実際使用の時の設定と関係がない。

**システム設定書式:**
- `#today`：システム時刻を参照する。今日の日付情報を返す。

#### b. 日時型

**仕様および注意点:**
- 「年月日＋時分（YMD + HM）」までを含み、より精密な時間制御が可能です。
- ミリ秒単位の精度を持ち、ワークフロー基盤のタイムゾーン（例：JST +09:00）に従って解釈されます。
- このドキュメントに、日時型データ項目は、`#q_datetime` で表示します、実際使用の時の設定と関係がない。

**システム設定書式:**
- `processInstanceStartDatetime`：プロセス開始日時を参照する。
- `#today`：システム時刻を参照する。今日の0時0分を返す。
- `#now`：システム時刻を参照する。今の時刻を返す。

---

### 2. メソッドの対応と例

対象オブジェクトのデータ型を日付型と日時型に分けて、よく使われるメソッドを整理します。

#### 日付型
##### addDays
- **説明**：指定された日数を加算します。正の値で未来、負の値で過去の日付または日時を得られます。
- **返り値の型**：日付型
- **引数**：`int days`
- **例**：`#q_date?.addDays(3)` → 3日後の日付（例：2025-07-01）
##### addMonths
- **説明**：指定された月数を加算します。年をまたぐ加算や月末処理にも対応します。
- **返り値の型**：日付型
- **引数**：`int months`
- **例**：`#q_date?.addMonths(2)` → 2ヶ月後の日付（例：2025-08-23）
##### getFirstDateInMonth
- **説明**：該当する月の1日を取得します。日付型で返します。このメソッドは日時型データとは併用できません。
- **返り値の型**：日付型
- **引数**：なし
- **例**：`#q_date?.getFirstDateInMonth()` → 2025-06-01
##### getFirstDateInWeek
- **説明**：該当する週の月曜日を取得します。日付型で返します。週の始まりは月曜日です。このメソッドは日時型データとは併用できません。
- **返り値の型**：日付型
- **引数**：なし
- **例**：`#q_date?.getFirstDateInWeek()` → 2025-06-16（月）
##### getFirstTimeInDate
- **説明**：該当日の 0時0分0秒 を取得します。日付型の値を日時型に変換する際によく使われます。
- **返り値の型**：日時型
- **引数**：なし
- **例**：`#q_date?.getFirstTimeInDate()` → 2025-06-23 0時00分
##### getLastDateInMonth
- **説明**：該当月の末日を取得します。月ごとの最終日を返します（28～31日）。うるう年にも対応します。このメソッドは日時型データとは併用できません。
- **返り値の型**：日付型
- **引数**：なし
- **例**：`#q_date?.getLastDateInMonth()` → 2025-06-30

#### 日時型
##### addMinutes
- **説明**：指定された分数を加算します。分単位で日時を加算できます。日付型には使用できません。
- **返り値の型**：日時型
- **引数**：`int minutes`
- **例**：`#q_datetime?.addMinutes(90)` → 90分後の日時（例：2025-06-23 11時30分）
##### addHours
- **説明**：指定された時間数を加算します。時刻単位で日時を加算できます。日付型には使用できません。
- **返り値の型**：日時型
- **引数**：`int hours`
- **例**：`#q_datetime?.addHours(6)` → 6時間後の日時（例：2025-06-23 18時00分）
##### addDays
- **説明**：指定された日数を加算します。正の値で未来、負の値で過去の日付または日時を得られます。
- **返り値の型**：日時型
- **引数**：`int days`
- **例**：`#q_date?.addDays(3)` → 3日後の日付（例：2025-07-01）
##### addMonths
- **説明**：指定された月数を加算します。年をまたぐ加算や月末処理にも対応します。
- **返り値の型**：日時型
- **引数**：`int months`
- **例**：`#q_date?.addMonths(2)` → 2ヶ月後の日付（例：2025-08-23）
##### getFirstTimeInDate
- **説明**：該当日の 0時0分0秒 を取得します。日付型の値を日時型に変換する際によく使われます。
- **返り値の型**：日時型
- **引数**：なし
- **例**：`#q_date?.getFirstTimeInDate()` → 2025-06-23 0時00分
##### getFirstTimeInWeek
- **説明**：その週の月曜日の 0時0分0秒 を取得します。週単位の処理や集計の基準日時に使われます。
- **返り値の型**：日時型
- **引数**：なし
- **例**：`#q_date?.getFirstTimeInWeek()` → 2025-06-16 0時00分
##### getFirstTimeInMonth
- **説明**：該当月の1日 0時0分0秒 を取得します。月初の時間情報を取得する際によく使われます。（このメソッドは、日付型の対象オブジェクトに対して使用することは推奨されません。）
- **返り値の型**：日時型
- **引数**：なし
- **例**：`#q_datetime?.getFirstTimeInMonth()` → 2025-06-01 0時00分
##### getLastTimeInMonth
- **説明**：月末の最終時刻（23:59:59.999）を取得します。内部的には「翌月1日の0時0分0秒」から1ミリ秒引いた値です。（このメソッドは、日付型の対象オブジェクトに対して使用することは推奨されません。）
- **返り値の型**：日時型
- **引数**：なし
- **例**：`#q_datetime?.getLastTimeInMonth()` → 2025-06-30 23時59分

---

### 3. セーフナビゲーション演算子

セーフナビゲーション演算子（`?.`）を使うと、入力値が null の場合でもエラーを起こさず、空文字や未出力として扱うことができます。そのため、値の存在を安全に確認しながらメソッドを呼び出すことが可能になります。

1つの式の中で複数のメソッドを連続して呼び出す場合でも、各メソッド呼び出しの前に ?. を付けることが推奨されます。
たとえ最初の ?. によって null チェックが行われていても、中間のメソッドが null を返す可能性がある場合、後続のメソッドでも ?. を使用しなければ安全性が保証されません。

**例：**
```
#q_date?.addDays(3)?.getLastTimeInMonth()
#q_publish_datetime?.addMonths(1)?.getFirstTimeInMonth()?.addHours(10)
```

---

### 4. 比較演算子による比較操作

**使用可能な比較演算子：**
- `<=`（以下または等しい）
- `==`（等しい）
- `>=`（以上または等しい）
- `!=`（等しくない）

**例：**
```
#q_date1 > #q_date2  // #q_date1の方が後  
#q_date1 < #q_date2  // #q_date1の方が前
```

---

### 5. 三項演算子による条件判断

三項演算子（`? :`）を使うことで、条件分岐を簡潔に記述できます。比較操作と一緒に使う場合が多い。

**例：**
```
#q_date1 < #q_date2 ? #q_date1 : #q_date2
→ #q_date1が#q_date2より小さい（前）であれば#q_date1を、そうでなければ#q_date2を返します。
```
---

### 6. エラーとなるケース

a. 日付型では、以下の二つの時刻操作系メソッドは使用できません：

- `addMinutes(int minutes)`
- `addHours(int hours)`

b. 日時型データでは、以下の3つのメソッドは使用できません：

- `getFirstDateInMonth()`
- `getLastDateInMonth()`
- `getFirstDateInWeek()`

c. 存在しないメソッドの使用は不可

存在しないメソッドを推測して使用することはできません。これまでに用意されているメソッドのみを使用してください。

- `#q_datetime?.getFirstDateInWeek()` → `#q_datetime?.getLastDateInWeek()`  
　※「getLastDateInWeek」は存在しないため使用できません

d. セーフナビゲーション演算子を使用していない場合、入力値が null だとエラーが発生します
