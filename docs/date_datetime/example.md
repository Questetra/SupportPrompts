---
title: 日付型／日時型データ項目を更新するサンプル
layout: default
date: 2025-10-14
nav_order: 2
lead: よくある質問をベースに、日付／日時データ項目の更新手順と EL 式サンプルをまとめました。
---

## **サンプル**

このページでは「日付型／日時型データ項目を更新する」[https://questetra.github.io/SupportPrompts/date_datetime/knowledge/](https://questetra.github.io/SupportPrompts/date_datetime/knowledge/) 

のサンプルを紹介しています。

---


#### 【質問1】

``` ワークフローアプリには、以下のデータ項目があります。

・申請日
・日付型
・フィールド名 q_application_date
・受付期限
・日付型
・フィールド名 q_deadline


「受付期限」の値を、「申請日の週明け」に更新したいです。
```



説明：日付型データを別の日付型に変換する処理です。他のメソッドについても同様の手順で対応します。


#### 【回答1】

```
EL式：#q_application_date?.addDays(7)?.getFirstDateInWeek()

#q_application_date 日付型

設定対象のデータ項目: q_deadline 日付型
```

---

#### 【質問2】

```
ワークフローアプリには、以下のデータ項目があります。

・契約開始日
・日付型
・フィールド名 q_contract_start
・契約終了日
・日付型
・フィールド名 q_contract_end


「契約終了日」の値を、「契約開始日から3営業日後」に更新したいです。
```

説明：この例は、ユーザーの要望が実現できない場合のパターンを示しています。

#### 【回答2】

```
ご質問ありがとうございます。「契約開始日から3営業日後」の「営業日」を計算する関数は、現在のところ提供されておりません。
```

---

#### 【質問3】

```
ワークフローアプリには、以下のデータ項目があります。

・修理受付の日
・日時型
・フィールド名 q_repair_acceptdate
・修理完了予定日時
・日時型
・フィールド名 q_repair_due 

修理完了予定日を、受付から12日後の午後6時に設定したい。
```

例の説明：
 - 更新対象が日付型の場合、日時型に変換することで時刻の操作が可能になります。
 - ユーザーの指定したデータ型が適切でないと判断される場合には、改善案も提示します。

#### 【回答3】

```
EL式：#q_repair_acceptdate?.addDays(12)?.getFirstTimeInDate()?.addHours(18)

設定対象のデータ項目: q_repair_due 日時型
```

---

#### 【質問4】

```
ワークフローアプリには、以下のデータ項目があります。

・プロジェクト締め切りの日時
・日時型
・フィールド名 q_duetime

締め切りをプロセス開始後一週間後の0時に設定したい。
```

説明：processInstanceStartDatetime、#today、#now のようなシステム提供値を使う場合に限り、セーフナビゲーション演算子（?.）は不要です。

#### 【回答4】

```
EL式：processInstanceStartDatetime.addDays(7).getFirstTimeInDate()

processInstanceStartDatetime 日時型（プロセス開始日時）

設定対象のデータ項目: q_duetime
```

---

#### 【質問5】

```
ワークフローアプリには、以下のデータ項目があります。

・プロジェクト開始日
・日付型
・フィールド名 q_start_date

プロジェクト開始日を今日より直前の金曜日に設定したいです。
```

説明：数日を加算して、現在の日付が金曜日より前か後かを判断する

#### 【回答5】

```
EL式：#today?.addDays(2)?.getFirstDateInWeek()?.addDays(-3)

設定対象のデータ項目: q_start_date 日付型
```

---

#### 【質問6】

```
ワークフローアプリには、以下のデータ項目があります。

・入社日
・日付型
・フィールド名 q_hire_date
・試用期間終了日時
・日時型
・フィールド名 q_trial_endtime

試用期間終了日時を、入社2ヶ月後末日、午前10時に設定したいです。
```

説明：
 - この例では、日付型と日時型の相互変換および、それぞれに適用できるメソッドについて説明しています。
 - 要望に時間情報が含まれているため、設定対象のデータ項目は日時型である必要があります。

#### 【回答6】

```
EL式：#q_hire_date?.addMonths(2)?.getLastDateInMonth()?.getFirstTimeInDate()?.addHours(10)

設定対象のデータ項目: q_trial_endtime
```

説明:入力が日付型の場合、.getFirstTimeInDate() を使って日時型に変換する必要があります。

--- 

#### 【質問7】

```
ワークフローアプリには、以下のデータ項目があります。

・基準時刻（UTC）
・日時型
・フィールド名 q_now_utc

・次回ローカル0時
・日時型
・フィールド名 q_next_local_midnight

要件：ユーザーのタイムゾーンやUTCオフセットの項目が存在しない前提で、「次回の現地日付の0:00（ローカル真夜中）」を計算して q_next_local_midnight に設定したい。
```


#### 【回答7】

```
この要件は、単体のEL式（データ更新のEL式）のみでは実現できません。理由は以下の通りです：

1. タイムゾーン情報がないため、UTCからローカル時刻への正確な変換ができません。
2. 夏時間（DST）により、地域や時期によって日付境界や0:00の扱いが変化しますが、EL式は外部のタイムゾーン規則にアクセスできません。
3. 文字型データ（タイムゾーンID等）を使わない条件では、少なくとも数値型のUTCオフセットやカレンダー規則の参照が必要ですが、EL式単体では取得できません。

実現方法の例：

・スクリプト処理でクライアント/サーバーからユーザーのタイムゾーンを取得し、`q_now_utc` をローカルに変換して次回0:00を算出し、`q_next_local_midnight` に設定する。
・代替案として、数値型のUTCオフセット項目（例：`q_utc_offset_minutes` 数値型）を追加し、その分だけ加減算してローカル0:00相当を近似計算する（ただしDST切替時には誤差が生じ得ます）。
```

---

#### 【質問8】

```
ワークフローアプリには、以下のデータ項目があります。

・プロジェクト1の開始日
・日付型
・フィールド名 q_date1

・プロジェクト2の開始日
・日付型
・フィールド名 q_date2

・プロジェクト3の開始日
・日付型
・フィールド名 q_date3

・プロジェクト截止日期
・日付型
・フィールド名 q_deadline

「データ更新」を使って、3つのプロジェクト開始日の中で最も遅い日付を求め、その日付に1週間を加算した日付を「プロジェクト締切日」として設定したいです。
```

説明：比較演算子と三項演算子を利用する例。

#### 【回答8】

```
EL式：#q_date1 >= #q_date2 && #q_date1 >= #q_date3 ? #q_date1?.addDays(7) : (#q_date2 >= #q_date3 ? #q_date2?.addDays(7) : #q_date3?.addDays(7))

設定対象のデータ項目: q_deadline

```

説明:この方法では、3つの日付を比較演算子と三項演算子を使って比較し、最も遅い日付を特定してから7日を加算します。

