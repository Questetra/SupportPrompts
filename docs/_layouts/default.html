<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: 'ja' }}">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>
    {% if page.title %}{{ page.title }} | {% endif %}{{ site.title }}
  </title>
  {% assign description = page.excerpt | default: page.description | default: site.description %}
  <meta name="description" content="{{ description | strip_html | strip_newlines | truncate: 160 }}">
  {% if site.google_fonts %}
    <link rel="stylesheet" href="{{ site.google_fonts }}">
  {% endif %}
  <link rel="stylesheet" href="{{ '/assets/css/style.css' | relative_url }}">
</head>
<body>
  <header class="kb-header">
    <div class="kb-header__inner">
      <div class="kb-header__branding">
        <a class="kb-header__brand" href="{{ '/' | relative_url }}">
          {{ site.title }}
        </a>
        <p class="kb-header__tagline">{{ site.description }}</p>
      </div>
      {% if site.navigation %}
      <nav class="kb-header__nav" aria-label="サイト内メニュー">
        {% for item in site.navigation %}
          {% assign normalized_page = page.url | append: '/' | replace: '//', '/' %}
          {% assign normalized_nav = item.url | append: '/' | replace: '//', '/' %}
          <a class="kb-header__nav-link{% if normalized_page == normalized_nav %} is-active{% endif %}" href="{{ item.url | relative_url }}">
            {{ item.title }}
          </a>
        {% endfor %}
      </nav>
      {% endif %}
    </div>
  </header>

  <main class="kb-main" id="main-content">
    <section class="kb-hero">
      <div class="kb-hero__inner">
        {% assign path_parts = page.url | split: '/' %}
        {% assign section_key = page.section | default: path_parts[1] | default: '' %}
        {% assign section_meta = site.sections[section_key] %}
        <nav class="kb-breadcrumb" aria-label="パンくずリスト">
          <a href="{{ '/' | relative_url }}">ホーム</a>
          {% if section_meta %}
            <span aria-hidden="true">›</span>
            <a href="{{ section_meta.url | relative_url }}">{{ section_meta.title }}</a>
          {% endif %}
          <span aria-hidden="true">›</span>
          <span class="kb-breadcrumb__current">{{ page.short_title | default: page.title }}</span>
        </nav>
        <h1 class="kb-hero__title">{{ page.title }}</h1>
        {% if page.lead %}
          <p class="kb-hero__lead">{{ page.lead }}</p>
        {% endif %}
      </div>
    </section>

    <div class="kb-content">
      {% assign siblings = site.pages | where: "dir", page.dir | sort: "nav_order" %}
      <aside class="kb-sidebar">
        <div class="kb-sidebar__card">
          <h2 class="kb-sidebar__title">{{ page.sidebar_title | default: '関連記事' }}</h2>
          <ul class="kb-sidebar__list">
            {% for sibling in siblings %}
              {% if sibling.title and sibling.url != page.url %}
                <li class="kb-sidebar__item">
                  <a class="kb-sidebar__link" href="{{ sibling.url | relative_url }}">{{ sibling.title }}</a>
                </li>
              {% endif %}
            {% endfor %}
            <li class="kb-sidebar__item">
              <span class="kb-sidebar__current">{{ page.title }}</span>
            </li>
          </ul>
        </div>
        {% if page.updated %}
          <p class="kb-sidebar__meta">最終更新: <time datetime="{{ page.updated | date_to_xmlschema }}">{{ page.updated | date: "%Y-%m-%d" }}</time></p>
        {% elsif page.date %}
          <p class="kb-sidebar__meta">公開日: <time datetime="{{ page.date | date_to_xmlschema }}">{{ page.date | date: "%Y-%m-%d" }}</time></p>
        {% endif %}
      </aside>

      <article class="kb-article">
        {{ content }}
      </article>
    </div>
  </main>

  <footer class="kb-footer">
    <div class="kb-footer__inner">
      <p class="kb-footer__brand">{{ site.title }}</p>
      <p class="kb-footer__meta">© {{ 'now' | date: '%Y' }} Questetra Support Prompts</p>
    </div>
  </footer>
</body>
</html>
